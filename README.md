## WB Dashboard — Аналитика заказов Wildberries

Небольшое Flask‑приложение для анализа заказов и продаж по API Wildberries: графики по дням, сводка по складам, ТОП товаров, экспорт в Excel, страница настроек для токена. Данные кэшируются в пределах сессии.

### Возможности
- Загрузка заказов и продаж за выбранный период (пагинация по lastChangeDate)
- Графики:
  - Количество заказов и продаж по дням
  - Выручка по дням (заказы и продажи)
- Сводка по складам: «Кол-во заказано» и «Кол-во продано»
- ТОП товаров по заказам + отдельная сводная таблица (фильтр по складу без перезагрузки страницы)
- Экспорт заказов в Excel (xlsx)
- Страница «Настройки» для ввода/очистки API‑токена
- Кэш последних результатов в пределах сессии

### Требования
- Python 3.11+ (рекомендовано)
- Доступный API‑токен Wildberries (Supplier Statistics API)

### Установка
```bash
python -m venv .venv
# Windows PowerShell
.\.venv\Scripts\Activate.ps1
# Linux/macOS
# source .venv/bin/activate

pip install -r requirements.txt
```

### Запуск
```bash
# (опционально) секрет для Flask-сессий
# Windows PowerShell
$env:FLASK_SECRET = "your-random-secret"

python app.py
# Откройте http://127.0.0.1:5000
```

### Первые шаги
1. Откройте «Настройки» и сохраните ваш WB API токен.
2. На странице «Заказы» выберите период и нажмите «Загрузить».
3. Изучайте графики и таблицы, при необходимости скачайте Excel.
4. Внизу страницы используйте «Сводная таблица: ТОП товаров по заказам» и фильтр по складу (обновляется без перезагрузки).

### Конфигурация
- Переменные окружения:
  - `FLASK_SECRET` — секрет сессий Flask (рекомендуется задать в продакшене)
- Токен WB сохраняется в сессии браузера (через страницу «Настройки»)

### Особенности и примечания
- API WB имеет ограничение по частоте/объему (возможны ответы 429). Приложение повторяет запросы с backoff и паузами между страницами.
- Кэш результатов сохраняется в папке `cache/` и автоматически подхватывается при повторном открытии страницы «Заказы».
- Экспорт в Excel выгружает именно заказы.

### Структура проекта
```
app.py
requirements.txt
templates/
  index.html
  settings.html
cache/               # кэш сессий (игнорируется в git)
.venv/               # виртуальное окружение (игнорируется)
```

### Эндпоинты
- `GET /` → редирект на `/orders`
- `GET|POST /orders` — главная страница аналитики
- `GET|POST /settings` — ввод/очистка токена
- `POST /export` — экспорт заказов в xlsx
- `GET /api/top-products-orders?warehouse=` — JSON с топом по заказам (для ajax‑фильтра)

### Траблшутинг
- HTTP 429 (Too Many Requests): сузьте период; приложение повторит запросы автоматически, но это займет больше времени
- Пустые графики/таблицы: выполните «Загрузить» для требуемого периода; кэш обновится

### Лицензия
MIT (по желанию смените на подходящую для проекта) 