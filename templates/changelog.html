<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Обновления и изменения — FuckBerry {{ app_version }}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
</head>
<body>
  {% include '_navbar.html' %}
  <div class="container mt-3">
    <h1 class="mb-3" style="font-size:1.7rem;">Обновления и изменения</h1>
    <div class="mb-3 text-muted">Текущая версия: {{ app_version }}</div>
    {% if current_user.is_authenticated and current_user.is_admin %}
      <div class="mb-3">
        <a class="btn btn-outline-primary btn-sm" href="/changelog/edit">Редактировать</a>
      </div>
    {% endif %}
    <div id="mdRaw" class="d-none">{{ md | e }}</div>
    <article id="mdOut" class="markdown-body"></article>
  </div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.5.1/github-markdown.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
  <script>
    (function(){
      const raw = document.getElementById('mdRaw');
      const out = document.getElementById('mdOut');
      if (!raw || !out) return;
      try{
        const src = raw.textContent || '';
        const html = marked.parse(src, { mangle:false, headerIds:true });
        out.innerHTML = DOMPurify.sanitize(html);
        // Tighten lists: unwrap single-paragraph list items (<li><p>..</p></li> -> <li>..</li>)
        out.querySelectorAll('li').forEach(function(li){
          const first = li.firstElementChild;
          if (li.childElementCount === 1 && first && first.tagName === 'P'){
            while (first.firstChild){ li.insertBefore(first.firstChild, first); }
            first.remove();
          }
        });
      }catch(e){ out.textContent = raw.textContent || ''; }
    })();
  </script>
  {% include '_footer.html' %}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
  </html>


