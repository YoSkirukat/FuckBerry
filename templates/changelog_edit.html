<!doctype html>
<html lang="ru">
<head>
  {% block title %}<title>Редактор ченджлога — FuckBerry {{ app_version }}</title>{% endblock %}
  {% include '_header.html' %}
</head>
<body>
  {% include '_navbar.html' %}
  <div class="container mt-3">
    <h1 class="mb-3" style="font-size:1.7rem;">Редактор ченджлога</h1>
    {% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
    {% if message %}<div class="alert alert-success">{{ message }}</div>{% endif %}
    <form method="post" action="/changelog/edit" class="row g-3">
      <div class="col-12 col-md-3">
        <label class="form-label">Текущая версия</label>
        <input type="text" class="form-control" name="version" value="{{ app_version }}" />
      </div>
      <div class="col-12 col-md-9 d-flex justify-content-end align-items-end">
        <div class="d-flex gap-2">
          <button class="btn btn-primary" type="submit">Сохранить</button>
          <a href="/changelog" class="btn btn-outline-secondary">Отмена</a>
        </div>
      </div>
      <div class="col-12">
        <label class="form-label">Содержимое (Markdown)</label>
        <textarea name="md_content" id="mdContent" class="form-control" rows="18" style="font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;">{{ md_content }}</textarea>
        <div class="form-text">Поддерживаются заголовки, списки, ссылки, жирный/курсив, кодовые блоки.</div>
      </div>
    </form>
  </div>
  {% include '_footer.html' %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
  <script>
    (function(){
      const ta = document.getElementById('mdContent');
      if (!ta) return;
      const easyMDE = new EasyMDE({
        element: ta,
        spellChecker: false,
        autofocus: true,
        autosave: { enabled: true, uniqueId: 'changelog-md', delay: 1000 },
        placeholder: 'Пишите содержимое в Markdown...'
      });
      document.querySelector('form[action="/changelog/edit"]')?.addEventListener('submit', function(){
        ta.value = easyMDE.value();
      });
    })();
  </script>
</body>
</html>


