<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Профиль — WB Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
</head>
<body>
  {% include '_navbar.html' %}
  <div class="container mt-3">
    <h1 class="mb-4" style="font-size:1.6rem;">Профиль</h1>

    <div class="row g-3">
      <div class="col-md-6">
        <div class="card h-100"><div class="card-body">
          <h6 class="mb-3">API токен Wildberries</h6>
          <form method="post" action="/profile/token" class="row g-3">
            <div class="col-12">
              <input name="token" type="password" class="form-control" value="{{ token }}" placeholder="Вставьте ваш WB токен" />
            </div>
            <div class="col-12 d-flex gap-2 align-items-center">
              <button class="btn btn-primary" type="submit">Сохранить</button>
              <button class="btn btn-outline-danger" type="submit" onclick="document.querySelector('[name=token]').value='';">Очистить</button>
              {% with msgs = get_flashed_messages() %}
                {% if msgs and 'Токен успешно добавлен' in msgs[-1] %}
                  <span class="text-success ms-2">Токен успешно добавлен</span>
                {% elif msgs and 'Токен удален' in msgs[-1] %}
                  <span class="text-success ms-2">Токен удален</span>
                {% elif msgs and 'Ошибка' in msgs[-1] %}
                  <span class="text-danger ms-2">{{ msgs[-1] }}</span>
                {% endif %}
              {% endwith %}
            </div>
          </form>

          {% if seller_info %}
            <div class="mt-3">
              <div class="text-muted">Наименование продавца</div>
              <div>{{ seller_info.name or seller_info.companyName or seller_info.supplierName }}</div>
            </div>
          {% endif %}
        </div></div>
      </div>

      <div class="col-md-6">
        <div class="card h-100"><div class="card-body">
          <h6 class="mb-3">Смена пароля</h6>
          <form method="post" action="/profile/password" class="row g-3">
            <div class="col-12">
              <input name="old_password" type="password" class="form-control" placeholder="Текущий пароль" required />
            </div>
            <div class="col-12">
              <input name="new_password" type="password" class="form-control" placeholder="Новый пароль" required />
            </div>
            <div class="col-12 d-grid">
              <button class="btn btn-secondary" type="submit">Обновить пароль</button>
            </div>
          </form>
          {% with msgs = get_flashed_messages() %}
            {% if msgs %}
              <div class="mt-2">
                {% set m = msgs[-1] %}
                <div class="{{ 'text-success' if 'Пароль обновлён' in m else 'text-danger' }}">{{ m }}</div>
              </div>
            {% endif %}
          {% endwith %}
        </div></div>
      </div>
    </div>

    <div class="row g-3 mt-3">
      <div class="col-md-12">
        <div class="card"><div class="card-body">
          <h6 class="mb-3">Реквизиты для этикеток</h6>
          <form method="post" action="/profile/shipping" class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Наименование отправителя</label>
              <input name="shipper_name" type="text" class="form-control" value="{{ current_user.shipper_name or '' }}" placeholder="ООО Ромашка / ИП Иванов..." />
            </div>
            <div class="col-md-6">
              <label class="form-label">Контактное лицо</label>
              <input name="contact_person" type="text" class="form-control" value="{{ current_user.contact_person or '' }}" placeholder="ФИО" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Телефон</label>
              <input name="phone" type="text" class="form-control" value="{{ current_user.phone or '' }}" placeholder="+7..." />
            </div>
            <div class="col-md-6">
              <label class="form-label">Email</label>
              <input name="email" type="email" class="form-control" value="{{ current_user.email or '' }}" placeholder="you@example.com" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Адрес склада отгрузки</label>
              <input name="shipper_address" type="text" class="form-control" value="{{ current_user.shipper_address or '' }}" placeholder="г. ..., ул. ..., склад ..." />
            </div>
            <div class="col-12 d-grid d-md-block">
              <button class="btn btn-primary" type="submit">Сохранить реквизиты</button>
            </div>
          </form>
        </div></div>
      </div>
    </div>

    <div class="card mt-4"><div class="card-body">
      <h6 class="mb-2">Срок действия учётной записи</h6>
      <div>Действует с: <strong>{{ valid_from or '-' }}</strong></div>
      <div>Действует по: <strong>{{ valid_to or '-' }}</strong></div>
      {% if validity_status %}
        <div class="mt-2"><span class="badge bg-{{ 'success' if validity_status=='active' else 'danger' }}">{{ 'Активна' if validity_status=='active' else 'Неактивна' }}</span></div>
      {% endif %}
    </div></div>
  </div>
  {% include '_footer.html' %}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 